<div class="small-margin row-big-space" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:ui="http://java.sun.com/jsf/facelets">
    <a href="#{authController.getBaseURL(request)}">
        <img src="#{request.contextPath}/resources/logo.png" alt="logo" class="logo" id="logo"/>
    </a>

    <div class="row-small-space low-height fill-up">
        <h:selectOneMenu id="category" value="#{categoryController.getSelectedMainCategory(request).getUuid().toString()}">
            <f:selectItem itemValue="" itemLabel="All Categories"/>
            <f:selectItems value="#{categoryController.categories}"/>
        </h:selectOneMenu>
        <input type="text" id="search" class="fill-up" value="#{request.getParameter('query')}"/>
        <button type="submit" id="submit" redirectTo="#{authController.getBaseURL(request)}"> Search</button>
    </div>

    <ui:param name="email" value="#{authController.extractEmail(request)}"/>
    <c:choose>
        <c:when test="#{email != null}">
            <div id="user">
                <span class="material-symbols-outlined">person</span>
                <h:outputText value="#{email}"/>
            </div>
        </c:when>
        <c:otherwise>
            <a href="#{request.contextPath}/application/login" id="user">
                <span class="material-symbols-outlined">person</span>
                <p> Login </p>
            </a>
        </c:otherwise>
    </c:choose>


    <a href="#{authController.getBaseURL(request)}/shopping-cart" id="go-to-cart">
        <span class="material-symbols-outlined big-icon">shopping_cart</span>
        <div class="circle accent-background" id="cart-count"> #{shoppingCartController.getShoppingCartEntries(request).size()} </div>
    </a>

    <script>
      let submit = document.getElementById("submit");

      submit.addEventListener("click", evt => {
        let value = document.getElementById("category").selectedOptions[0].value;
        let query = document.getElementById("search").value;
        let redirectTo = submit.getAttribute("redirectTo");

        let searchParams = new URLSearchParams();
        searchParams.set("categoryUuid", value);
        searchParams.set("query", query);
        searchParams.set("page", "1");

        location.assign(redirectTo + "?" + searchParams.toString())
      });

      document.addEventListener("DOMContentLoaded", () => {
          // fill header with cached values
          let filterValue = new URLSearchParams(new URL(sessionStorage.getItem("main-page")).search);
          document.getElementById("category").value = filterValue.get("categoryUuid") ?? "";
          document.getElementById("search").value = filterValue.get("query") ?? "";
      });
    </script>
</div>