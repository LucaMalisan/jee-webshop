<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AuthMailSender.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jee-webshop</a> &gt; <a href="index.source.html" class="el_package">src.auth</a> &gt; <span class="el_source">AuthMailSender.java</span></div><h1>AuthMailSender.java</h1><pre class="source lang-java linenums">package src.auth;

import jakarta.mail.*;
import jakarta.mail.internet.*;
import java.util.Properties;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import lombok.extern.java.Log;
import src.model.User;
import javax.naming.Context;

/**
 * Class to send account confirmation mail after first login
 */

<span class="nc" id="L16">@Log</span>
<span class="nc" id="L17">public class AuthMailSender {</span>

  public void sendMail(User user, String baseURL)
      throws NamingException, MessagingException {
<span class="nc" id="L21">    Context env = (Context) new InitialContext().lookup(&quot;java:comp/env&quot;);</span>

<span class="nc" id="L23">    String to = user.getEmail();</span>
<span class="nc" id="L24">    String from = (String) env.lookup(&quot;email.address&quot;);</span>

<span class="nc" id="L26">    Properties props = new Properties();</span>
<span class="nc" id="L27">    props.put(&quot;mail.smtp.auth&quot;, &quot;true&quot;);</span>
<span class="nc" id="L28">    props.put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;);</span>
<span class="nc" id="L29">    props.put(&quot;mail.smtp.host&quot;, &quot;smtp.gmail.com&quot;);</span>
<span class="nc" id="L30">    props.put(&quot;mail.smtp.port&quot;, &quot;587&quot;);</span>

    //authenticate with email account credentials (email + app-password)
<span class="nc" id="L33">    Session session =</span>
<span class="nc" id="L34">        Session.getInstance(</span>
            props,
<span class="nc" id="L36">            new Authenticator() {</span>
              protected PasswordAuthentication getPasswordAuthentication() {
                try {
<span class="nc" id="L39">                  return new PasswordAuthentication(from, (String) env.lookup(&quot;email.password&quot;));</span>
<span class="nc" id="L40">                } catch (NamingException e) {</span>
<span class="nc" id="L41">                  throw new RuntimeException(e);</span>
                }
              }
            });

    //set properties of e-mail
<span class="nc" id="L47">    Message message = new MimeMessage(session);</span>
<span class="nc" id="L48">    message.setFrom(new InternetAddress(from));</span>
<span class="nc" id="L49">    message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(to));</span>
<span class="nc" id="L50">    message.setSubject(&quot;Please confirm your email&quot;);</span>

    //provide link to user containing the confirmation key stored in database
<span class="nc" id="L53">    message.setText(</span>
<span class="nc" id="L54">        String.format(</span>
            &quot;Thanks for your registration at JEE webshop. Please confirm your email at %s/confirm-email/%s&gt;here&lt;/a&gt;&quot;,
<span class="nc" id="L56">            baseURL, user.getConfirmKey()));</span>

<span class="nc" id="L58">    new Thread(</span>
            () -&gt; {
              try {
<span class="nc" id="L61">                Transport.send(message);</span>
<span class="nc" id="L62">              } catch (Exception ignored) {</span>
<span class="nc" id="L63">              }</span>
<span class="nc" id="L64">            })</span>
<span class="nc" id="L65">        .start();</span>
<span class="nc" id="L66">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>